<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Laravel 9.x 中文文档</title>
    <link rel="stylesheet" href="../style/idea.css">
<link rel="stylesheet" href="../style/bd0cbd7aa15e5518a47099735133bf3a-vendors.css">
<link rel="stylesheet" href="../style/a91e47e2539b98438cb4c6c3a665d642-app.css">
    <style>
        div.markdown-body {
            margin: 0 10px;
        }
    </style>
</head>

<body>
    <div class="markdown-body"><h1 id="编译前端资源（mix）">编译前端资源（Mix）</h1>
<ul>
<li><a href="#introduction">简介</a></li>
<li><a href="#installation">安装 &amp; 设置</a></li>
<li><a href="#running-mix">运行 Mix</a></li>
<li><a href="#working-with-stylesheets">使用样式表</a><ul>
<li><a href="#tailwindcss">Tailwind CSS</a></li>
<li><a href="#postcss">PostCSS</a></li>
<li><a href="#sass">Sass</a></li>
<li><a href="#url-processing">URL 处理</a></li>
<li><a href="#css-source-maps">资源映射</a></li>
</ul>
</li>
<li><a href="#working-with-scripts">使用 JavaScript</a><ul>
<li><a href="#vue">Vue</a></li>
<li><a href="#react">React</a></li>
<li><a href="#vendor-extraction">Vendor 提取</a></li>
<li><a href="#custom-webpack-configuration">自定义 Webpack 配置</a></li>
</ul>
</li>
<li><a href="#versioning-and-cache-busting">版本控制 / 缓存清除</a></li>
<li><a href="#browsersync-reloading">Browsersync 重新加载</a></li>
<li><a href="#environment-variables">环境变量</a></li>
<li><a href="#notifications">通知</a></li>
</ul>
<p><a name="introduction"></a></p>
<h2 id="简介">简介</h2>
<p><a href="https://github.com/laravel-mix/laravel-mix">Laravel Mix</a> 是一个由 <a href="https://laracasts.com">Laracasts</a> 所开发的拓展包，作者 Jeffrey Way 。其使用了常见的 CSS 和 JavaScript 预处理器，为定义 <a href="https://webpack.js.org">webpack</a> 构建步骤提供了流畅的 API。</p>
<p>换句话说，Mix 使您可以轻松地编译和压缩应用程序中的 CSS 和 JavaScript 文件。通过链式调用这些简洁方法，可以流畅地定义资源管道。例如：</p>
<pre><code class="language-js">mix.js(&#39;resources/js/app.js&#39;, &#39;public/js&#39;)
    .postCss(&#39;resources/css/app.css&#39;, &#39;public/css&#39;);
</code></pre>
<p>如果您曾经对使用 Webpack 和资源编译感到困惑和不知所措，那么你一定会喜欢 Laravel Mix。但你不一定非要使用它来开发应用，你可以使用你喜欢的任何资源管道工具，甚至干脆不用。</p>
<blockquote>
<p>技巧：如果您需要先开始使用 Laravel 和 <a href="https://tailwindcss.com">Tailwind CSS</a> 构建应用程序，请查看我们的 <a href="starter-kits.html">应用程序入门工具包</a>。</p>
</blockquote>
<p><a name="installation"></a></p>
<h2 id="安装--配置">安装 &amp; 配置</h2>
<p><a name="installing-node"></a></p>
<h4 id="安装-node">安装 Node</h4>
<p>在运行 Mix 之前，要先确保您的机器上已经安装了 Node.js 和 NPM：</p>
<pre><code class="language-shell">node -v
npm -v
</code></pre>
<p>您可以从 <a href="https://nodejs.org/en/download/">Node 官网</a> 使用图形化安装器轻松安装最新版本的  Node 和 NPM。或者，如果您使用的是 <a href="sail.html">Laravel Sail</a> 则可以通过  Sail 调用 Node 和 NPM：</p>
<pre><code class="language-shell">./sail node -v
./sail npm -v
</code></pre>
<p><a name="installing-laravel-mix"></a></p>
<h4 id="安装-laravel-mix">安装 Laravel Mix</h4>
<p>剩下的事就是安装 Laravel Mix。在全新安装的 Laravel 中，您会在应用目录结构的根目录中找到 <code>package.json</code> 文件。 默认的 <code>package.json</code> 包含了使用 Laravel Mix 所需要的所有东西。 您可以把它想象成为 <code>composer.json</code> 文件，只是它定义的是 Node 依赖而不是 PHP 依赖。您可以像这样来安装依赖：</p>
<pre><code class="language-shell">npm install
</code></pre>
<p><a name="running-mix"></a></p>
<h2 id="运行-mix">运行 Mix</h2>
<p>Mix 是 <a href="https://webpack.js.org">webpack</a> 的顶层配置，因此如果您要执行 Mix 任务，您只需要执行一条被包含于 Laravel 默认的 <code>package.json</code> 文件中的 NPM 脚本。当您运行 <code>dev</code> 或 <code>production</code> 脚本时， 应用程序的所有 CSS 和 JavaScript 资源文件都将被编译并放置在应用程序的 <code>public</code> 目录中：</p>
<pre><code class="language-shell"><span class="comment token">// 运行所有的 Mix 任务…</span>
npm run dev

<span class="comment token">// 运行所有的 Mix 任务并最小化输出…</span>
npm run prod
</code></pre>
<p><a name="watching-assets-for-changes"></a></p>
<h4 id="监听静态资源的变化">监听静态资源的变化</h4>
<p><code>npm run watch</code> 命令将会在您的终端中持续运行，并监听所有相关的 CSS 和 JavaScript 文件的修改。当发现文件有任何改动时， Webpack 将会自动重新编译它们：</p>
<pre><code class="language-shell">npm run watch
</code></pre>
<p>您会发现在特定的环境下， 文件的修改并不会触发 Webpack 的更新。如果在您的系统中发生了这样的事，您可以考虑使用 <code>watch-poll</code> 命令:</p>
<pre><code class="language-shell">npm run watch-poll
</code></pre>
<p><a name="working-with-stylesheets"></a></p>
<h2 id="使用样式表">使用样式表</h2>
<p><code>webpack.mix.js</code> 是所有静态资源编译的入口。 您可以将其看成是 <a href="https://webpack.js.org">webpack</a> 的轻量配置封装。Mix 任务能够与定义了静态资源的编译方式的配置一起被链式调用。</p>
<p><a name="tailwindcss"></a></p>
<h3 id="tailwind-css">Tailwind CSS</h3>
<p><a href="https://tailwindcss.com">Tailwind CSS</a> 是一种实用程序优先的现代框架，可在不离开 HTML 的情况下构建出色的网站。让我们研究一下如何在 Laravel Mix 的 Laravel 项目中开始使用它。首先，我们应该使用 NPM 安装 Tailwind 并生成我们的 Tailwind 配置文件：</p>
<pre><code class="language-shell">npm install

npm install -D tailwindcss

npx tailwindcss init
</code></pre>
<p> <code>init</code> 命令将生成一个 <code>tailwind.config.js</code> 文件。该文件的 <code>content</code> 部分允许您配置所有 HTML 模板、JavaScript 组件和任何其他包含 Tailwind 类名称的源文件的路径，以便 Tailwind 在优化生产环境中的 CSS 时，可以削减未使用的样式：</p>
<pre><code class="language-js">content: [
    &#39;./storage/framework/views/*.php&#39;,
    &#39;./resources/**/*.blade.php&#39;,
    &#39;./resources/**/*.js&#39;,
    &#39;./resources/**/*.vue&#39;,
],
</code></pre>
<p>接下来，您应该将 Tailwind 的每个「层」添加到应用中的 <code>resources/css/app.css</code> 文件：</p>
<pre><code class="language-css">@tailwind base;
@tailwind components;
@tailwind utilities;
</code></pre>
<p>配置 Tailwind 的层后，请更新应用中的 <code>webpack.mix.js</code> 文件，如此便可编译 Tailwind 支持的 CSS：</p>
<pre><code class="language-js">mix.js(<span class="string token">'resources/js/app.js'</span>, <span class="string token">'public/js'</span>)
    .postCss(<span class="string token">'resources/css/app.css'</span>, <span class="string token">'public/css'</span>, [
        <span class="keyword token">require</span>(<span class="string token">'tailwindcss'</span>),
    ]);
</code></pre>
<p>最后，您应当在应用的主布局模板中引用您的样式表。很多应用都将该模板存储于 <code>resources/views/layouts/app.blade.php</code> 中。此外，如果它还未正常显示，请确保您已经添加了 <code>meta</code> 标签：</p>
<pre><code class="language-blade">&lt;head&gt;
    &lt;meta charset="UTF-8" /&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;
    &lt;link href="/css/app.css" rel="stylesheet"&gt;
&lt;/head&gt;
</code></pre>
<p><a name="postcss"></a></p>
<h3 id="postcss">PostCSS</h3>
<p><a href="https://postcss.org/">PostCSS</a> 是一个强大的工具，它可以转换您的 CSS ，它已经包含在 Laravel Mix 中，并可开箱即用。默认情况下，Mix 利用流行的 <a href="https://github.com/postcss/autoprefixer">Autoprefixer</a> 插件来自动附加所有必要的 CSS3 前缀。当然，您亦可自由地添加任何应用所需的附加组件。</p>
<p>首先，通过 NPM 安装所需的插件。然后，在调用 Mix 的 <code>postCss</code> 方法的时候，将其添加到您的插件数组中。 <code>postCss</code> 方法的第一个参数为 CSS 文件的路径，第二个参数为编译后的文件的位置路径：</p>
<pre><code class="language-js">mix.postCss(<span class="string token">'resources/css/app.css'</span>, <span class="string token">'public/css'</span>, [
    <span class="keyword token">require</span>(<span class="string token">'postcss-custom-properties'</span>)
]);
</code></pre>
<p>或者，为了实现简单的 CSS 的编译和压缩，您可以在不使用其他插件的情况下执行 <code>postCss</code> :</p>
<pre><code class="language-js">mix.postCss(&#39;resources/css/app.css&#39;, &#39;public/css&#39;);
</code></pre>
<p><a name="sass"></a></p>
<h3 id="sass">Sass</h3>
<p><code>sass</code> 方法允许您将 <a href="https://sass-lang.com/">Sass</a> 编译成 Web 浏览器可以理解的 CSS 文件。<code>sass</code> 方法的第一个参数是您的 Sass 文件的路径，第二个参数是编译后的文件的存储路径：</p>
<pre><code class="language-js">mix.sass(&#39;resources/sass/app.scss&#39;, &#39;public/css&#39;);
</code></pre>
<p>您可以将多个 Sass 文件编译成各自的 CSS 文件，甚至可以通过多次调用 <code>sass</code> 方法来自定义生成的 CSS 的输出目录：</p>
<pre><code class="language-js">mix.sass(&#39;resources/sass/app.sass&#39;, &#39;public/css&#39;)
    .sass(&#39;resources/sass/admin.sass&#39;, &#39;public/css/admin&#39;);
</code></pre>
<p><a name="url-processing"></a></p>
<h3 id="url-处理">URL 处理</h3>
<p>因为 Laravel Mix 是基于 Webpack 之上构建的，所以了解几个 webpack 的概念就很重要了。对于 CSS 编译，webpack 将会重写和优化在样式表中的任何 <code>url()</code> 调用。虽然初听起来很奇怪，但这确实是一个很强大的功能。想象一下我们想要编译包含图片相对 URL 的 Sass：</p>
<pre><code class="language-css">.example {
    background: url(&#39;../images/example.png&#39;);
}
</code></pre>
<blockquote>
<p>注意：任何给定 <code>url()</code> 的绝对路径将被排除在 URL 重写之外。例如， <code>url(&#39;/images/thing.png&#39;)</code> 或 <code>url(&#39;http://example.com/images/thing.png&#39;)</code> 将不会作任何修改。</p>
</blockquote>
<p>默认情况下，Laravel Mix 和 Webpack 将会寻找到 <code>example.png</code>，并将其复制到您的 <code>public/images</code> 文件夹中，然后重写生成的样式表中的 <code>url()</code> 。如此一来，编译后的 CSS 将变为：</p>
<pre><code class="language-css">.example {
    background: url(/images/example.png?d41d8cd98f00b204e9800998ecf8427e);
}
</code></pre>
<p><a name="css-source-maps"></a></p>
<h3 id="源码映射">源码映射</h3>
<p>Source map 默认是关闭的，你可以在 <code>webpack.mix.js</code> 文件中调用 <code>mix.sourceMaps()</code> 方法来打开 Source map 功能。尽管这会给前端编译带来一些性能负担，但是在使用浏览器调试时就会很方便找到对应的代码:</p>
<pre><code class="language-js">mix.js(&#39;resources/js/app.js&#39;, &#39;public/js&#39;)
    .sourceMaps();
</code></pre>
<p><a name="style-of-source-mapping"></a></p>
<h4 id="源码映射样式">源码映射样式</h4>
<p>Webpack 提供了多种 <a href="https://webpack.js.org/configuration/devtool/#devtool">源码映射样式</a>。在默认情况下 Mix 的源码映射使用 <code>eval-source-map</code>模式，它快速构建非常快。 如果你想更改映射样式可以使用 <code>sourceMaps</code> 方法:</p>
<pre><code class="language-js">let productionSourceMaps = <span class="keyword token">false</span>;

mix.js(<span class="string token">'resources/js/app.js'</span>, <span class="string token">'public/js'</span>)
    .sourceMaps(productionSourceMaps, <span class="string token">'source-map'</span>);
</code></pre>
<p><a name="working-with-scripts"></a></p>
<h2 id="使用-javascript">使用 JavaScript</h2>
<p>Mix 提供了多种功能来帮助您处理 JavaScript 文件，例如编译最新的 ECMAScript 语法，模块化，代码压缩和合并 JavaScript 文件。更棒的是，所有这些都可以无缝运行，而无需大量的自定义配置:</p>
<pre><code class="language-js">mix.js(&#39;resources/js/app.js&#39;, &#39;public/js&#39;);
</code></pre>
<p>通过这一行代码，你现在就可以实现：</p>
<div class="content-list" markdown="1">

<ul>
<li>支持最新的 EcmaScript 语法</li>
<li>支持模块化开发</li>
<li>在生产环境的代码压缩最小化</li>
</ul>
</div>

<p><a name="vue"></a></p>
<h3 id="vue">Vue</h3>
<p>当使用 <code>vue</code> 方法时，Mix 会自动安装编译 Vue 组件所需要的 Babel 插件。 不需要其他任何配置。</p>
<pre><code class="language-js">mix.js(&#39;resources/js/app.js&#39;, &#39;public/js&#39;)
   .vue();
</code></pre>
<p>编译 JavaScript 后，您可以在应用程序中引用它:</p>
<pre><code class="language-blade">&lt;head&gt;
    &lt;!-- ... --&gt;

    &lt;script src="/js/app.js"&gt;&lt;/script&gt;
&lt;/head&gt;
</code></pre>
<p><a name="react"></a></p>
<h3 id="react">React</h3>
<p>Mix 可以自动安装 React 支持所需的 Babel 插件。 首先，请添加一个对 <code>react</code> 方法的调用：</p>
<pre><code class="language-js">mix.js(&#39;resources/js/app.jsx&#39;, &#39;public/js&#39;)
   .react();
</code></pre>
<p>Mix 将在后台下载并包含相应的 <code>babel-preset-react</code> Babel  插件。编译 JavaScript 后，您可以在应用程序中引用它：</p>
<pre><code class="language-blade">&lt;head&gt;
    &lt;!-- ... --&gt;

    &lt;script src="/js/app.js"&gt;&lt;/script&gt;
&lt;/head&gt;
</code></pre>
<p><a name="vendor-extraction"></a></p>
<h3 id="提取-vendor">提取 Vendor</h3>
<p>将应用程序本身所有的 JavaScript 与 vendor 库（例如 React 和 Vue ）捆绑在一起的潜在缺点是：这会使长期缓存变得更加困难。 例如，对应用程序代码进行一次更新将迫使浏览器重新下载所有 vendor 库，即使它们没有更改。</p>
<p>如果打算频繁更新应用程序的 JavaScript，则应考虑将所有 vender 库提取到它们自己的文件中。 这样，对应用程序代码的更改将不会影响大型 <code>vendor.js</code> 文件的缓存。 Mix 的  <code>extract</code> 方法使这变得轻而易举：</p>
<pre><code class="language-js">mix.js(&#39;resources/js/app.js&#39;, &#39;public/js&#39;)
    .extract([&#39;vue&#39;])
</code></pre>
<p><code>extract</code> 方法接受你希望提取到 <code>vendor.js</code> 文件中的所有库或模块的数组。 以上面的代码段为例，Mix 将生成以下文件：</p>
<div class="content-list" markdown="1">

<ul>
<li><code>public/js/manifest.js</code>: <em>Webpack 运行时清单</em></li>
<li><code>public/js/vendor.js</code>: <em>vendor 库</em></li>
<li><code>public/js/app.js</code>: <em>你的应用程序代码</em></li>
</ul>
</div>

<p>为避免 JavaScript 错误，请确保以正确的顺序加载这些文件:</p>
<pre><code class="language-html">&lt;script src="/js/manifest.js"&gt;&lt;/script&gt;
&lt;script src="/js/vendor.js"&gt;&lt;/script&gt;
&lt;script src="/js/app.js"&gt;&lt;/script&gt;
</code></pre>
<p><a name="custom-webpack-configuration"></a></p>
<h3 id="自定义-webpack-配置">自定义 Webpack 配置</h3>
<p>有时候你可能需要手动修改 Webpack 配置，例如，你可能需要引入特殊的 <code>loader</code> 或者插件。</p>
<p>Mix 提供非常有用的 <code>webpackConfig</code> 方法可以让你覆盖 Webpack 的配置。这非常吸引人，因为它不需要你复制和维护自己的 <code>webpack.config.js</code> 文件。 <code>webpackConfig</code> 方法接收一个对象你可以传入你希望的 <a href="https://webpack.js.org/configuration/">Webpack 特定配置</a> 。</p>
<pre><code class="language-js">mix.webpackConfig({
    resolve: {
        modules: [
            path.resolve(__dirname, &#39;vendor/laravel/spark/resources/assets/js&#39;)
        ]
    }
});
</code></pre>
<p><a name="versioning-and-cache-busting"></a></p>
<h2 id="版本管理--缓存销毁">版本管理 / 缓存销毁</h2>
<p>许多开发者在他们编译后的资源添加时间戳或唯一令牌作后缀，强制浏览器加载新的资源，以替换旧的代码副本。Mix 可以使用 <code>version</code> 方法替你处理它们。</p>
<p><code>version</code> 方法自动在所有编译后的文件名后追加唯一的哈希值，从而实现更方便的缓存销毁：</p>
<pre><code class="language-js">mix.js(&#39;resources/js/app.js&#39;, &#39;public/js&#39;)
    .version();
</code></pre>
<p>在生成版本化文件后，你不会知道确切的文件名。因此，你需要在 <a href="views.html">视图</a> 中使用Laravel 的全局 <code>mix</code> 函数载入相应的哈希资源。 <code>mix</code> 函数自动判断哈希文件的当前文件名：</p>
<pre><code class="language-blade">&lt;script src="{{ mix('/js/app.js') }}"&gt;&lt;/script&gt;
</code></pre>
<p>通常在开发阶段不需要版本化文件，你可以仅在运行 <code>npm run prod</code> 时执行版本化处理：</p>
<pre><code class="language-js">mix.js(<span class="string token">'resources/js/app.js'</span>, <span class="string token">'public/js'</span>);

<span class="keyword token">if</span> (mix.inProduction()) {
    mix.version();
}
</code></pre>
<p><a name="custom-mix-base-urls"></a></p>
<h4 id="自定义-mix-base-urls">自定义 Mix Base URLs</h4>
<p>如果你的 Mix 编译资产被部署到独立于应用程序的 CDN 上，则需要更改 <code>mix</code> 函数生成的基本 URL 。 你可以通过在 <code>config/app.php</code> 中添加一个 <code>mix_url</code> 配置选项来做到这一点。php 的配置文件:</p>
<pre><code><span class="string token">'mix_url'</span> =&gt; env(<span class="string token">'MIX_ASSET_URL'</span>, <span class="keyword token">null</span>)
</code></pre>
<p>在配置了 Mix URL 之后，<code>mix</code> 函数将在生成资产 URL 时为所配置的 URL 添加前缀:</p>
<pre><code class="language-shell">https:<span class="comment token">//cdn.example.com/js/app.js?id=1964becbdd96414518cd</span>
</code></pre>
<p><a name="browsersync-reloading"></a></p>
<h2 id="browsersync-重加载">Browsersync 重加载</h2>
<p><a href="https://browsersync.io/">BrowserSync</a> 能够自动监测文件变化，并且无需手动刷新就将变化注入到浏览器。可以调用 <code>mix.browserSync()</code> 方法开启此项支持：</p>
<pre><code class="language-js">mix.browserSync(&#39;laravel.test&#39;);
</code></pre>
<p>可以将 <a href="https://browsersync.io/docs/options">BrowserSync 选项</a> 通过 Javascript 对象传递给 <code>browserSync</code> 方法来指定:</p>
<pre><code class="language-js">mix.browserSync({
    proxy: &#39;laravel.test&#39;
});
</code></pre>
<p>然后使用 <code>npm run watch</code> 命令启动 Webpack 的开发服务器。再编辑脚本或者 PHP 文件，就会看到浏览器立即刷新以响应你的修改。</p>
<p><a name="environment-variables"></a></p>
<h2 id="环境变量">环境变量</h2>
<p>你可以通过在 <code>.env</code> 文件中添加 <code>MIX_</code> 前缀，将环境变量注入到 Mix：</p>
<pre><code class="language-ini">MIX_SENTRY_DSN_PUBLIC=http:<span class="comment token">//example.com</span>
</code></pre>
<p>如果你在 <code>.env</code> 文件中定义了变量的话，你可以通过  <code>process.env</code> 对象来访问它。 但如果你在任务运行的时候修改了变量的值，你就需要重新启动任务了:</p>
<pre><code class="language-js">process.env.MIX_SENTRY_DSN_PUBLIC
</code></pre>
<p><a name="notifications"></a></p>
<h2 id="通知">通知</h2>
<p>如果系统支持 Mix ， 将在编译时自动显示操作系统通知，为您提供有关编译是否成功的及时反馈。但是在某些情况下，您可能希望禁用这些通知。 比如在生产服务器上。禁用通知可以使用 <code>disableNotifications</code> 方法:</p>
<pre><code class="language-js">mix.disableNotifications();
</code></pre>
</div>
    <blockquote style="font-size: 0.9em;">
        本译文仅用于学习和交流目的，转载请务必注明文章译者、出处、和本文链接 <br>
        我们的翻译工作遵照 <a href="https://learnku.com/docs/guide/cc4.0/6589">CC 协议</a>，如果我们的工作有侵犯到您的权益，请及时联系我们。
    </blockquote>
</body>

</html>
